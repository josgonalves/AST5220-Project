# AST5220 Project (Spring 2025)
## Overview
This is the Github repository containing the code I developed for the AST5220 numerical project during the Spring semester of 2025. 

In terms of code, it contains both C++ source and header files that were based on templates provided by the lecturer and python scripts that were made for the sole purpose of plotting or otherwise extracting results. 

In terms of results, it contains .txt files generated by executing the C++ programs (and that are then to be read by the python scripts) and plots generated in matplotlib, most of which are also present in the report of the project.

To run the code, simply download the repository and run the commands "make" and "./cmb" in the terminal to execute the C++ code. To obtain the plots, run the python scripts one by one afterward. 

Keep in mind that, to facilitate debugging after milestone I, the line `mcmc_fit_to_supernova_data("data/supernovadata.txt", "results_supernovafitting.txt")` in `Main.cpp` was commented out - if you wish to check the supernova fitting results, uncomment this line.

## Files of general use
- `Utils.h` and `Utils.cpp` - Define physical units and constants (which can be accessed in any other file by writing `Constants.[name of constant]`). Define a namespace `Utils` that contains functions capable of:
    - Timing how long a part of a program takes (`StartTiming` and `EndTiming`)
    - Searching for a value in a spline (`binary_search_for_value`);
    - Creating a linearly spaced `vector<double>` between two endpoints with `npts` number of points (`linspace(x_start, x_end, npts)`);
    - Computing the ordinary and spherical bessel functions, `J_n(n, x)` `j_ell(l, x)` 
- `ODESolver.h`, `ODESolver.cpp`, `Spline.h`, `Spline.cpp` - Wrappers around the `GSL` library that facilitate the integration of ordinary differential equations and the splining of discrete arrays into continuous functions, respectively.

## Milestone I - Background Cosmology
- `BackgroundCosmology.h` and `BackgroundCosmology.cpp` - Header and source files that declare and define the `BackgroundCosmology` class and all of its parameters and methods.
    - **Private Parameters**:
     - `h`: The Hubble parameter today, `H0`, in units of 100 Km/s/Mpc. `H0` itself is also a private parameter;
     - `OmegaB`, `OmegaCDM`, `OmegaR`, `OmegaNu`, `OmegaLambda`, `OmegaK`: Density parameters of the different particle species, as well as dark-energy and curvature today;
     - `TCMB`: Mean temperature of the cosmic microwave background today;
     - `Neff`: Effective numer of relativistic species;
     - A `BackgroundCosmology` object is initialized by specifying the values of `h`, `OmegaB`, `OmegaCDM`, `OmegaK`, `Neff` and `TCMB`. The remaining private parameters are derived from these.

    - **Methods**
     - `solve`: main method for this class, solves the differential equations for conformal and cosmic times and splines the results to obtain `eta` and `t` as continuous functions of `x` (where `x` is the logarithm of the scale factor);
     - `info`: prints the values of cosmological parameters and the sum of the density parameters;
     - `output`: takes a str `filename` as input. Outputs the evolution of several quantities for 1500 linearly spaced values of `x` between -15 and 0 to `filename.txt`, along with the current age of the Universe and the times of matter radiation equality, matter dark-energy equality and start of acceleration
     - `get_(...)`: several methods for fetching either the values of the density parameters and the distance measures (luminosity, angular, comoving) at a given `x` or the values of constant parameters such as `Neff`, `TCMB`;
     - `(...)_of_x`: used to fetch quantities such as the regular and conformal Hubble parameters or `eta` and `t` for a given value of `x`;
     - `Remaining methods`: used to obtain the values of `x` for important events in the evolution of the Universe.

-  `SupernovaFitting.h` - Defines a function `mcmc_fit_to_supernova_data`. It takes two strings, `supernovadata_filename` (in the case of this project, `data\supernovadata`, which contains the redshifts, luminosity distances and their errors for 31 supernovas) and `outfile`. 
 - This function performs Markov chain Monte Carlo with a `BackgroundCosmology` object by varying 3 of its parameters (`h`, `OmegaK` and `OmegaM`). For all accepted steps, the values of these 3 parameters, along with the chi squared obtained by comparing the predicted luminosity distances with those present in `data\supernovadata`, are printed into `outfile.txt`.

- `BackgroundPlots.py` and `Supernova_fit_plots.py`: python scripts that produce the plots for the background quantities and the supernova fits and save them to `Project_plots\Background_cosmology` and `Project_plots\Supernova_fit`, respectively.
    
## Milestone II - Recombination History
- `RecombinationHistory.h` and `RecombinationHistory.cpp` - Header and source files that declare and define the `RecombinationHistory` class and all of its parameters and methods.
    - **Private Parameters**:
     - `*cosmo`: A pointer to a `BackgroundCosmology` object (in this project, this was simply the one built in milestone I);
     - `Yp`: Helium fraction;
     - `zreion`, `dzreion`: Parameters that describe reionization (when it started and how long it lasted, respectively).
     - A `RecombinationHistory` object is initialized by specifying the pointer `*cosmo` and the values of `Yp`, `zreion`, `dzreion`.

    - **Methods**
     - `solve`: main method for this class, solves the equation and splines the solution for the evolution of:
        - The free electron fraction utilizing both the Saha and the Peebles equations, `solve_number_density_electrons`;
        - The optical depth and visibility function, `solve_for_optical_depth_tau`;
        - The sound horizon, `solve_sound_horizon`;
        - In doing so, utilizes a number of auxiliary functions that, for example, define the right hand side of the Peebles equation separately.
     - `info`: prints the values of `Yp`, `zreion` and `dzreion`;
     - `output`: takes a str `filename` as input. Outputs the evolution of several quantities for 5000 linearly spaced values of `x` between -15 and 0 to `filename.txt`. Outputs the times of Last Scattering and Recombination both for the full solution and the Saha approximation and the value of the sound horizon at decoupling.
     - `(...)_of_x`: used to, for a given value of `x`, fetch quantities such as:
        - The optical depth, `tau`, or the visibility function, `g_tilde`, along with their first two derivatives;
        - The free electron fraction, `Xe`, and the electron number density, `ne`;
        - `tau`, `g_tilde` and `Xe` can be determined with or without accounting for reionization. `Xe` can also be determined only considering the Saha approximation.

- `RecombinationPlots.py`: python script that produces the plots for the recombination and saves them to `Project_plots\Recombination_history`.

## Milestone III - Evolution of Structure in the Universe
- `Perturbations.h` and `Perturbations.cpp` - Header and source files that declare and define the `Perturbations` class and all of its parameters and methods.
    - **Private Parameters**:
     - `*cosmo`: A pointer to a `BackgroundCosmology` object (in this project, this was simply the one built in milestone I);
     - `*rec`: A pointer to a `RecombinationHistory` object (in this project, this was simply the one built in milestone II);
     - `k_min`, `k_max`, `n_k`: minimum and maximum values of `k`, and number of different values of `k` to be used for solving differential equations and splining. The `k` arrays are set up with logarithmic spacing between `k_min` and `k_max`;
     - `x_start`, `x_end`, `n_x`: minimum and maximum values of `x`, and number of different values of `x` to be used for solving differential equations and splining. The `x` arrays are set up with linear spacing between `x_start` and `x_end`;
     - A `Perturbations` object is initialized by specifying the pointers `*cosmo` and `*rec`.
    - **Methods**
     - `solve`: main method for this class. Solves the system of differential equations for the perturbations and splines the results to produce bidimensional functions of `(x,k)` (`integrate_perturbations`). Also computes the source functions for the CMB and matter power spectra (`compute_source_functions`).
        - The system is evolved separately between `x_start` and `x_end` for each value of `k` between `k_min` and `k_max`;
        - The 2 systems of equations and sets of initial conditions (both in the tight-coupling and full regimes) are defined in separate, auxiliary methods.
     - `compute_source_functions`: computes the temperature and polarization source functions (relevant for milestone IV);
     - `info`: prints information about how the system of perturbations is being integrated (most importantly, the `k` and `x` limits and number of points and the inclusion of `neutrinos` and/or `polarization`);
     - `output`: takes a double `k` and a str `filename` as inputs. Outputs the evolution of the perturbations and source functions for 5000 linearly spaced values of `x` between `x_start` and `x_end`, while keeping `k` fixed, to `filename.txt`. Outputs the times of matter radiation equality, matter dark-energy equality and Last Scattering.
     - `get_(...)`: used to, for a given pair of values `(x, k)`, fetch the following perturbations:
        - The density perturbations for baryons, `delta_b`, and cold dark matter, `delta_cdm`;
        - The velocity perturbations for baryons, `v_b`, and cold dark matter, `v_cdm`;
        - The metric perturbations, `Psi` and `Phi`;
        - The quantity `Pi = Theta2 + Thetap0 + Thetap2`;
        - The temperature and polarization source functions, `Source_T` and `Source_E`, respectively;
        - The first three multipoles for the temperature perturbations of photons, `Theta`, neutrinos, `Nu` and polarizations, `Thetap`. For these methods, an additional integer value of `ell` between `0` and `2` must be specified to indicate which multipole is being determined;
- `PerturbationPlots.py`: python script that produces the plots for the perturbations and saves them to `Project_plots\Perturbations`.
## Milestone IV - The CMB and matter power spectra
- `PowerSpectrum.h` and `PowerSpectrum.cpp` - Header and source files that declare and define the `PowerSpectrum` class and all of its parameters and methods.
    - **Private Parameters**:
     - `*cosmo`: A pointer to a `BackgroundCosmology` object (in this project, this was simply the one built in milestone I);
     - `*rec`: A pointer to a `RecombinationHistory` object (in this project, this was simply the one built in milestone II);
     - `*pert`: A pointer to a `Perturbations` object (in this project, this was simply the one built in milestone III);
     - `A_s`, `n_s`: cosmological parameters (primordial amplitude and spectral index, respectively);
     - `kpivot_mpc`: the value of the arbitrary pivot scale in Mpc^-1;
     - `separate_components`: boolean variable that decides whether or not to separately calculate the contribution from each component of the temperature source function;
     - `k_min`, `k_max`: minimum and maximum values of `k` for the line of sight and C_ell integrals;
     - `ells`: vector containing 63 values of `ell` for which the coefficients in the CMB power spectra are calculated;
     - `j_ell_splines`: vector of 63 splines for the spherical Bessel functions of each `ell` in `ells`;
     - `(...)_ell_of_k_spline`: vectors of 63 splines (one for each `ell` in `ells`) for the transfer functions computed utilizing line of sight integration;
     - `cell_(...)_spline`: splines for interpolating the 63 angular power coefficients that are computed into continuous functions of `ell`;
     - A `PowerSpectrum` object is initialized by specifying `A_s`, `n_s`, `kpivot_mpc`, `separate_components` and the pointers `*cosmo`, `*rec`, `*pert`.
    - **Methods**
     - `solve`: main method for this class:
        - It begins by setting up three arrays (`k_array_1`,`k_array_2` and `log_k_array`). The first two are linearly spaced in `k` and used in splining the Bessel functions and the transfer functions from L.O.S. integration, respectively. The third is linearly spaced in `log(k)` and used for computing the `C_ell` integral;
        - It then generates splines of the spherical Bessel functions in terms of `k*eta_0` (`generate_bessel_function_splines`);
        - Afterward, it performs L.O.S. integration. The method `line_of_sight_integration_single` is defined to take any function of `(x,k)` as an argument and produce a 2D vector containing 63 arrays (one for each of the transfer functions computed). The method `line_of_sight_integration` calls upon `line_of_sight_integration_single` with the source functions from milestone III as arguments, calculating the temperature and polarization multipoles and interpolating the results, outputting a vector of splines;
        - Finally, the method `solve_for_cell`, which can take any vector of splines of `k` as an argument and perform the `cell` integrals for them, is called for the outputs of the previous point. This produces 63 values of `cell_TT`, `cell_EE` and `cell_TE`, which are splined into continuous functions 
     - `get_matter_power_spectrum`: computes `P(k,x)` for any pair of values of the two variables;
     - `get_k_eq`: compute the value of `k` at matter radiation equality;
     - `get_cell_(...)`: fetch the value of the `cell_TT`, `cell_EE` or `cell_TE` splines for any `ell`;
     - `output`: takes two strings, `filename1` and `filename2` as inputs. Outputs the following files:
        - The values of the `cell_TT`,`cell_EE` and `cell_TE`splines (multiplied by a normalization factor for plotting) for all `ell` between 2 and `max(ells)` are output to `filename1`;
        - The values of `P(x = 0, k)` and all 63 `theta_T` splines for a set of linearly spaced points between `k_min` and `k_max` are output to `filename2`. `filename2` also contains the `k` value at matter radiation equality;
        - If `separate_components` is set to `True`, a third file (defaulting to the name `contributions.txt`) is produced with the values of the `cell` splines of each term in the temperature source functions, multiplied by the same normalization factor as before.      
- `PowerSpectrumPlots.py`: python script that produces the plots for the perturbations and saves them to `Project_plots\PowerSpectra`.
